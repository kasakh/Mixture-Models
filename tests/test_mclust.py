from Mixture_Models import *
from tests import utils

constraint_specific_inits = {
    "VVV": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [
            [-0.48253284, 0.51413704],
            [0.11431507, 0.22256881],
            [-0.56830111, 0.06756844],
        ],
        "orientations": [
            [[1.484537, -1.07980489], [-1.97772828, -1.7433723]],
            [[0.26607016, 2.38496733], [1.12369125, 1.67262221]],
            [[0.09914922, 1.39799638], [-0.27124799, 0.61320418]],
        ],
    },
    "EVV": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [
            [0.21651309, 0.60151869],
            [-0.48253284, 0.51413704],
            [0.11431507, 0.22256881],
        ],
        "orientations": [
            [[-1.13660221, 0.13513688], [1.484537, -1.07980489]],
            [[-1.97772828, -1.7433723], [0.26607016, 2.38496733]],
            [[1.12369125, 1.67262221], [0.09914922, 1.39799638]],
        ],
    },
    "VEV": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [-0.48253284, 0.51413704],
        "orientations": [
            [[0.22863013, 0.44513761], [-1.13660221, 0.13513688]],
            [[1.484537, -1.07980489], [-1.97772828, -1.7433723]],
            [[0.26607016, 2.38496733], [1.12369125, 1.67262221]],
        ],
    },
    "EEV": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [0.21651309, 0.60151869],
        "orientations": [
            [[-0.96506567, 1.02827408], [0.22863013, 0.44513761]],
            [[-1.13660221, 0.13513688], [1.484537, -1.07980489]],
            [[-1.97772828, -1.7433723], [0.26607016, 2.38496733]],
        ],
    },
    "VVE": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [
            [-0.48253284, 0.51413704],
            [0.11431507, 0.22256881],
            [-0.56830111, 0.06756844],
        ],
        "orientations": [[1.484537, -1.07980489], [-1.97772828, -1.7433723]],
    },
    "EVE": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [
            [0.21651309, 0.60151869],
            [-0.48253284, 0.51413704],
            [0.11431507, 0.22256881],
        ],
        "orientations": [[-1.13660221, 0.13513688], [1.484537, -1.07980489]],
    },
    "VEE": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [-0.48253284, 0.51413704],
        "orientations": [[0.22863013, 0.44513761], [-1.13660221, 0.13513688]],
    },
    "EEE": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [0.21651309, 0.60151869],
        "orientations": [[-0.96506567, 1.02827408], [0.22863013, 0.44513761]],
    },
    "VVI": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [
            [-0.48253284, 0.51413704],
            [0.11431507, 0.22256881],
            [-0.56830111, 0.06756844],
        ],
        "orientations": [],
    },
    "EVI": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [
            [0.21651309, 0.60151869],
            [-0.48253284, 0.51413704],
            [0.11431507, 0.22256881],
        ],
        "orientations": [],
    },
    "VEI": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [-0.48253284, 0.51413704],
        "orientations": [],
    },
    "EEI": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [0.21651309, 0.60151869],
        "orientations": [],
    },
    "VII": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011, 0.21651309, 0.60151869],
        "log shapes": [],
        "orientations": [],
    },
    "EII": {
        "log proportions": [0.66579325, 0.35763949, -0.77270015],
        "means": [
            [-0.00419192, 0.31066799],
            [-0.36004278, 0.13275579],
            [0.05427426, 0.00214572],
        ],
        "log volumes": [-0.08730011],
        "log shapes": [],
        "orientations": [],
    },
}


def run_constraint(constraint):
    test_GMM, init_params = utils.init_MM(
        Mclust,
        default_pinwheel_data,
        10,
        init_params_args={"num_components": 3, "scale": 0.5},
        expected=constraint_specific_inits[constraint],
        constraint=constraint,
    )
    utils.check_fromfile(
        test_GMM,
        init_params,
        "grad_descent",
        {"learning_rate": 0.0005, "mass": 0.9, "maxiter": 100},
        "expected_test_mclust_" + constraint + "_illustration.json",
        ["likelihood", "aic", "bic"],
    )


def test_mclust_illustration():
    for constraint in {
        "EII",
        "VII",
        "EEI",
        "VEI",
        "EVI",
        "VVI",
        "EEE",
        "VEE",
        "EVE",
        "VVE",
        "EEV",
        "VEV",
        "EVV",
        "VVV",
    }:
        run_constraint(constraint)
